# `tw-chat`

## CLI

### Installation

#### Release

`npm install -f @teamwork/chat-almighty`

#### Manual install

Clone the repository and `npm install`:

    $ git clone https://github.com/adriancooney/chat-api-client.git
    $ cd chat-api-client/
    $ npm install

Next, build the CLI and then `npm link`:

    $ npm run build
    $ npm link

#### Development

Clone the repository and `npm install`:

    $ git clone https://github.com/adriancooney/chat-api-client.git
    $ cd chat-api-client/
    $ npm install

Next, install `babel-cli` globally and then link the `tw-chat` binary into a folder in your `$PATH`:

    $ npm install -g babel-cli
    $ ln -s ./bin/tw-chat /usr/local/bin/tw-chat

## API

<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### PING_INTERVAL

The time in ms between pings.

Type: [number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)

### PING_MAX_ATTEMPT

The maximum amount of pings allowed fail before the socket is like "hang on,
something isn't right" and it assumes the connection is broken then
forcefully disconnects the socket from the server (it does not wait until
the `readyState` is `WebSocket.CLOSED` that is, it's really slow).

Type: [number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)

### PING_TIMEOUT

The timeout in ms for the ping `socketRequest`. This, in conjunction with
PING_INTERVAL and PING_MAX_ATTEMPT, allows you to configure the reaction
time for broken connection to the server. To calculate the maximum amount
of time before the APIClient will realize the connection is broken, use
this formula:

     PING_INTERVAL + (PING_MAX_ATTEMPT * PING_TIMEOUT)

     5000 + (3 * 3000) = 14000ms or 14 seconds until `close` event fires.

Type: [number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)

### STATUS_TYPES

The legal values for updating user status with `updateStatus`.

### APIClient

**Extends EventEmitter**

The (mostly) raw connector to the Teamwork Chat API. This intentionally DOES NOT
transform the returned response from the API (aside from deserializing the JSON),
that is left up to the TeamworkChat class. This class does not know about any
Person, Message or Room objects and only accepts values.

Events:

     "connected":

         Emitted when the client successfully connects to the API socket. This is
         emitted after authentication was successful.
         
     "message": ({String} message)

         Emitted when the client recieves a "message" from the server.
     
     "frame": ({Object} frame)

         Emitted when the client recieves a "message" from the server and the contents
         of the message is parsed.
         
     "close":

         Emitted when the connection to the server closes.
         
     "error": ({Error} error)

         Emitted when an error occurs within the API client (usually in the underlying
         Websocket).

#### awaiting

The filters waiting to be matches to frames.

#### user

The current logged in user's account details returned from `me.json`

#### constructor

Create an authorized APIClient object.

**Parameters**

-   `installation` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's installation.
-   `auth` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The `tw-auth` token.

Returns **[APIClient](#apiclient)** The authorized APIClient instance.

#### send

Send a raw object down the socket.

**Parameters**

-   `frame` **([Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))** The object (will be serialized) or string.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))>** The frame object (or string) sent.

#### sendFrame

Send a frame down the socket to the server.

**Parameters**

-   `name` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The type of the frame. See APICLient.createFrame.
-   `contents` **Any?= 
     ** The contents of the frame.
-   `type`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves the raw packet object sent down the line.

#### awaitFrame

Await a frame given a filter.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** A filter supplied to APIClient.matchFrame.
-   `timeout` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= he cl** The number in ms before timing out (defaults 30s).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the raw object packet returned from the server.

#### raceFrames

Await multiple packets and pick (resolve) the first.

**Parameters**

-   `filters` **...[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Filters applied to APIClient#awaitFrame.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the raw object packet returned from the server.

#### socketRequest

Send a request down the socket. A "request" is a frame that receives a response (i.e.
matching nonces).

**Parameters**

-   `type` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The type of the frame. See APICLient.createFrame.
-   `frame` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The contents of the frame. See APICLient#createFrame.
-   `timeout` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of ms before timing out the request.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the reponse frame.

#### onSocketError

Event Handler: when the client's websocket emits "error"

**Parameters**

-   `error` **[Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)** 

#### onSocketMessage

Event Handler: when the client's websocket emits "message"

**Parameters**

-   `message` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Raw frame string returned from server.

#### onSocketClose

Event Handler: when the client's websocket emits "close"

#### initialize

Initialize (but not connect) the API account. This sets up all non-websocket related things.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User account returned from API.

#### connect

Connect to the Chat socket server.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[APIClient](#apiclient)>** Resolves when the server has successfully completed authentication.

#### nextPing

Start sending ping frames (not Websocket pings) down the socket to ensure the server doesn't cut
our connection. This STARTS the pinging and will resolve when you stop the pinging with `stopPing`.

**Parameters**

-   `attempt` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= e** PRIVATE: The number used to track which attempt were on, do not use.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** A promise that resolves when `stopPing` is called.

#### stopPing

Stop sending the ping frames to the server.

#### close

Close the socket connection to the server. This IMMEDIATELY calls `onSocketClose`
i.e. the `close` event. It doesn't wait for the underlying socket to close it's 
connection to the server because it is SLOW.

#### connected

Test if socket is connected to server.

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** connected or not.

#### sendMessage

Socket Event: "room.message.created" - Send (or create) a message to a room.

**Parameters**

-   `room` **[Room](#room)** The target room to recieve the message.
-   `message` **Message** The message to send.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** The raw response frame returned from the server.

#### updateStatus

Update the currently logged in user's status.

**Parameters**

-   `status` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** One of: "idle"|"active"

#### getUnseenCount

Get the unseen counts from the server.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the unseen counts frame from the socket server.

#### activateRoom

Send the `room.user.active` frame for a room.This frame has no response, it's fire and forget.

**Parameters**

-   `room` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID to send the room active frame for.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the sent frame.

#### typing

Send the `room.typing` frame for a room. This frame has no response, it's fire and forget.

**Parameters**

-   `isTyping` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether typing or not.
-   `room` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the sent frame.

#### ping

Send a ping frame to the server. This socket request times out after
PING_TIMEOUT and rejects the promise.

**Parameters**

-   `timeout` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?=       ...opt** The timeout before the socket request times out. Default: PING_TIMEOUT

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Resolves to the recieved ping frame.

#### request

Make an _authenticated_ request to the Teamwork API.

**Parameters**

-   `path` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The path part of the URL to be appended to the user installation for the request.
-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?= ha** See APIClient.request.
-   `requester`   (optional, default `n", {
               `)

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5))>** See APIClient.request return value.

#### requestList

Make an authenticated request for a list of items from the server with offset and limit.

**Parameters**

-   `target` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The URL target. See APIClient.request.
-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The options object passed to APIClient.requestList.
-   `path`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))>** See APIClient.request return value.

#### getProfile

GET /chat/me.json - Return the currently logged in user's account.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** User's account details. See Teamwork API Docs.

#### getPeople

GET /chat/v2/people.json - Return a list of people.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?= rn** Passed filter params to the API.
    -   `filter.since` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Timestamp to only return values updated since timestamp.
-   `offset` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The cursor offset on the list of people.
-   `limit` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The amount of people to return after the cursor offset.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** The list of people.

#### getPerson

GET /chat/people/<id>.json - Get a person by ID.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person's ID.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Person object response.

#### updatePerson

PUT /chat/people/<id>.json - Update a persons details.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person's ID.
-   `update` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The update object.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** The API response object.

#### createRoom

POST /chat/v2/rooms.json - Create a new room with handles and an initial message.

**Parameters**

-   `handles` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** Array of user handles (without `@` symbol).
-   `message` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The initial message for the new room.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** The server response with the room ID.

#### deleteRoom

DELETE /chat/room/<room>.json - Delete a room.

**Parameters**

-   `room` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves when the room is deleted.

#### updateRoomTitle

PUT /chat/v2/conversations/<room>.json - Update a room title.

This could be a generic "update" room method but one: there are only
two ways a conversation details and two: the methods are vastly
different.

**Parameters**

-   `room` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID to update.
-   `title` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The room title.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves when update is complete.

#### getRoom

GET /chat/v2/rooms/<room>.json - Get a room from the server.

**Parameters**

-   `room` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID.
-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Filter returned results.
    -   `filter.includeUsers` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Include user data in returned results.
-   `$1` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default ``his.request(`/chat/v2/``)
    -   `$1.includeUsers`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Return a room object from the API.

#### getRooms

GET /chat/v2/conversations.json - Return list of conversations.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Filter returned rooms (i.e. query appended to URL).
    -   `filter.includeMessages` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Include message data (last message) in the returned rooms.
    -   `filter.includeUsers` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Include data for people in rooms.
    -   `filter.sort` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Sort results, values: "lastActivityAt"
    -   `filter.status` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Filter by status, values: "all"
    -   `filter.since` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Return conversations that have activity after timestamp.
-   `offset` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= r** The conversation cursor offset.
-   `limit` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= -C** The number of conversations after the cursor to get.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)>** The list of conversations. See Teamwork API Docs.

#### getUserMessages

Get a logged in user's messages (without room). 

Note: Unfortunately, this doesn't follow the other pagination schema so you're 
on your own with regards to iterating the pages and the like.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Object containing filters.
    -   `filter.since` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Timestamp to get message from now until `since`.
-   `page` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= j** The page number.
-   `pageSize` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)?= o ** The amount of messages to return per page.
-   `$0` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 
    -   `$0.since`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** The messages from the API.

#### getMessages

GET /chat/v2/rooms/<room>/messages.json - Get messages for a room.

**Parameters**

-   `room` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The messages return from the API.

#### impersonate

PUT /people/<person>/impersonate.json - Impersonate a user.

TODO: Move this to it's own Projects API Client Mixin.
TODO: Discuss this, ethically.

**Parameters**

-   `person` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person's ID.
-   `revert` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?=  \* @p** Revert an ongoing impersonation. Don't use this however, use `unimpersonate`. The
                                 logic for reverting the impersonation is so close to creating the impersonation,
                                 it would be criminal to have a seperate request method. If this method is true
                                 (default: false), the `person` parameter is unnecessary and should be `null`.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** Resolves to the user's `tw-auth` cookie.

#### unimpersonate

Unimpersonate a user and refresh the auth token.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves when the impersonation is complete.

#### logout

DELETE /launchpad/v1/logout.json - Logout from Teamwork.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Value returned from server.

#### inspect

Custom `console.log` output.

#### toJSON

Convert this instance to JSON (returns the data required to exactly recreate this instance).

Example:

     const { installation, auth } = chat.toJSON();

     const newChat = new TeamworkChat(installation, auth);

     newChat.connect().then(chat => {
         // Connected chat!
     });

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Serialized TeamworkChat.

#### WebSocket

#### request

Make an _unauthenticated_ request to the Teamwork API.

**Parameters**

-   `target` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The fully qualified URL to fetch.
-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?= ons.headers,
     ** See Fetch API `fetch` options.
    -   `options.raw` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether or not to return the raw response object.
    -   `options.query` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** An object that's stringified as the URL's query parameters (see `qs` module).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5))>** Raw Response object or parsed JSON response.

#### requestList

Make an unauthenticated request for a list of items from the server with offset and limit.

**Parameters**

-   `target` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The URL target. See APIClient.request.
-   `options` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The options object passed to APIClient.request.
    -   `options.offset` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The cursor offset.
    -   `options.limit` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The number of items to return after `offset`.
-   `$1` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)**  (optional, default ` r`)
    -   `$1.offset`  
    -   `$1.limit`  
    -   `$1.options` **...any** 

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;([Response](https://developer.mozilla.org/en-US/docs/Web/Guide/HTML/HTML5) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))>** See APIClient.request return value.

#### getAccounts

GET authenticate.teamwork.com/launchpad/v1/accounts.json - Return a user's accounts.

**Parameters**

-   `username` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's username.
-   `password` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's password.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Returns list of user's accounts. See Teamwork API Docs.

#### login

POST <installation>/launchpad/v1/login.json - Login to Teamwork with credentials.

**Parameters**

-   `installation` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's installation hostname.
-   `username` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's username.
-   `password` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's password.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** Resolves to the user's login token `tw-auth`.

#### loginWithCredentials

Login and connect to the chat server.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The user's installation.
-   `username` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's username.
-   `password` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's password.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[APIClient](#apiclient)>** Resolves to a new instance of APIClient that can make authenticated requests
                                      as the user. The user's details can be access at `APIClient.user`.

#### loginWithAuth

Login with a pre-existing auth key.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The user's installation.
-   `auth` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's auth key (this will fail if the auth key is invalid or expired).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[APIClient](#apiclient)>** Resolves to a new instance of APIClient that can make authenticated requests
                                       as the user. The user's details can be access at `APIClient.user`.

#### loginWithKey

Login with a Projects "API Key".

**Parameters**

-   `installation` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's installation.
-   `key` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The "API Key".

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[APIClient](#apiclient)>** Resolves to an authenticated APIClient instance.

#### createFrame

Create a frame to send to the socket server.

**Parameters**

-   `type` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The frame type or identifier.
-   `contents` **Any?=  \*** The contents of the frame.
-   `nonced` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?=   co** Whether or not to nonce the frame.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The raw object packet to be stringified and sent to the server.

#### matchFrame

Test if a filter matches a give frame.

Filters:
    Filters are objects that describe how to match the passed frame. They
    are essentially like an Object Regex specifically made for Teamwork
    Chat socket frames. The filter objects can contain various properties
    that dictate how we match that frame. The follow properties are supported:

         "type"      {String}    Match the exact frame type.
         "nonce"     {Number}    Match the exact nonce of the frame.
         "contents"  {Object}    Deep equal contents object.

    Fitlers can also be specified in shorthand:
     - If the filter is a string, it is converted to a `{ type: <filter> }` object.

**Parameters**

-   `fitlers` **([Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))** See "Filters" section above.
-   `frame` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The raw frame packet returned from the server.
-   `filter`  

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** Whether or not the filter matches the frame.

#### normalizeInstallation

Conver an installation input (object or string) to a string.

**Parameters**

-   `installation` **([Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object) \| [String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String))** The installation descriptor.

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The installation URL.

### Room

**Extends EventEmitter**

The Room model.

Events:

     "updated": ({Object} changes)

         Emitted when the room is updated.

     "person:new": ({Person} person)

         Emitted when a new person is added to the room.

     "person:updated": ({Person} person, {Object} changes)

         Emitted when a person in the room changes.

     "message": ({Message} message)

         Emitted when the room receives a new message.

#### id

#### type

#### title

#### status

#### unreadCount

#### importantUnreadCount

#### lastActivityAt

#### lastViewedAt

#### updatedAt

#### createdAt

#### creatorId

#### messages

#### people

#### constructor

Create a new Room.

**Parameters**

-   `api` **[APIClient](#apiclient)** Authorized APIClient instance.
-   `details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Optional, room details from API.
-   `participants` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>** Optional, list of room particpants.

Returns **[Room](#room)** 

#### update

Update the room object.

**Parameters**

-   `details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The details to update (usually API response).

Returns **[Room](#room)** The updated room object.

#### updateTitle

Update the title of the room with the API.

**Parameters**

-   `title` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The new title.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Room](#room)>** The updated room.

#### findPersonById

Find a person in memory by ID.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person's ID.

Returns **[Person](#person)** 

#### addPerson

Add a new person to the room.

**Parameters**

-   `person` **[Person](#person)** The person to add.

Returns **[Person](#person)** The added person.

#### addPeople

Add multiple person objects to a room.

**Parameters**

-   `people` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>** Array of person objects.

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>** The added person objects.

#### deletePerson

Delete a person from the room.

**Parameters**

-   `person` **[Person](#person)** The person to delete.

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>** The deleted person.

#### handleAddedPerson

Handle a new person to the room.

**Parameters**

-   `person` **[Person](#person)** The new person.

Returns **[Person](#person)** The added person.

#### handleRemovedPerson

Handle a new person to the room.

**Parameters**

-   `person` **[Person](#person)** The new person.

Returns **[Person](#person)** The added person.

#### handleMessage

Event Handler: When a new message is sent to the room.

**Parameters**

-   `message` **Message** The new message object.

#### addMessage

Add a new message to the room.

**Parameters**

-   `message` **Message** The new message.

Returns **Message** The newly added message.

#### getMessages

Get and save messages for a room.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Message>>** The message objects from the API.

#### saveMessage

Save or create a message to the room.

**Parameters**

-   `rawMessage` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The raw message returned from the API.

Returns **Message** The newly created (or saved) message object.

#### delete

Delete the room from the API.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves when the room is deleted.

#### findMessageById

Find a message in memory by ID.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The message ID.

Returns **Message** The found message object.

#### sendMessage

Send a message to the room (or create it if uninitialized).

There's an unfortunate case where this function could be used (and is, see tw-chat-message)
to send a message before (any or) all the rooms are loaded into memory. In that case, this
function will _always_ create a new room for the message because it doesn't know what room
to send it to otherwise. The API really should know to put the message into the pair
conversation but it doesn't look like it does.

**Parameters**

-   `message` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Message content.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;Message>** Resolves to the sent message.

#### activate

Tell the server the currently logged in user is active in this room.

Returns **Promse** Resolves once the frame is sent (there is no ack/fire and forget).

#### typing

Send the `typing` event as the currently logged in user to the current room.

**Parameters**

-   `isTyping` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?= titl** Whether or not the user is typing.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves when the frame is sent (again, no ack of the frame).

#### initialized

Determine whether the current room instance has been initialized. "Initialized" simply
means has the room an ID or not.

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### inspect

Convert the room object to useful debuggable object (`util.inspect`).

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

#### toJSON

Serialize the room object.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

### Person

**Extends EventEmitter**

Person model.

Events:

 "updated": ({Person} person, {Object} changes)

     Emitted when the person object has been updated.

 "message": ({Message} message)

     Emitted when the direct conversation gets a new message. This is fired
     when the a message is sent or received.

 "message:sent": ({Message} message)

     Emitted when the currently logged in user sends a message to the current
     Person object.

 "message:received": ({Message} message)

     Emitted when the currently logged in user receives a message from the
     current Person object.

#### id

#### handle

#### firstName

#### lastName

#### email

#### title

#### lastActivity

#### constructor

Create a new Person object.

**Parameters**

-   `api` **[APIClient](#apiclient)** The authorized API Client instance.
-   `details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Optional, the person details to pass to Person#Update.

Returns **[Person](#person)** 

#### onMessage

Event Handler: When a room receives a message.

**Parameters**

-   `message` **Message** The new message object.

#### sendMessage

Send a message to this person instance.

**Parameters**

-   `message` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The string message.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;Message>** Resolves to the sent message.

#### update

Update the current Person object.

**Parameters**

-   `details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Person details (from API).

Returns **[Person](#person)** The current person instance.

#### isMentioned

Determine if a user has been mentioned in a message.

**Parameters**

-   `message` **Message** The message object.

Returns **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)** 

#### toJSON

Serialize the Person.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

#### toString

Convert the Person to a string.

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** e.g. `@adrianc`

#### inspect

Convert Person object to useful debug string (`util.inspect`).

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### content

### id

### roomId

### userId

### status

The "status" of a message. It can contain one of two values (I've found):

-   "active" - Message is unchanged.
-   "redacted" - Message has been removed.

### file

### createdAt

### thirdPartyCards

### isUserActive

### constructor

Create a new Message.

**Parameters**

-   `details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Optional, passed to #update. See Message#update.

Returns **Message** 

### update

Update the message's details and do type conversions on the data.

**Parameters**

-   `details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)?=  c** Message object returned from server.

Returns **Message** The current message instance.

### inspect

Convert to usable string output for `console.log`.

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

### RECONNECT_INTERVAL

The time in ms to wait between reconnection attempts.

### TeamworkChat

**Extends Person**

TeamworkChat model.

Takes care of creating, updating and deleting Person, Room and Message objects
by accepting frames and handling fresh data.

Events:

     "user:update": ({Person} person, {Object} changes)

         Emitted when the currently logged in user has been updated.

     "person:new": ({Person} person)

         A new person was added to the memory store. This DOES NOT MEAN a new
         person was added to the company or projects, just that they have been
         loaded into memory. Once they have all been loaded into memory and this
         event happens, it's safe to assume the person was recently created in
         projects. See `person:created` for a new person added to Projects.

     "person:updated": ({Person} person, {Object} changes)

         A person was updated e.g. their status, "offline" to "online"

     "person:created": ({Person} person)

         When a new person is created in Projects.

     "message": ({Room} room, {Message} message)

         When a room receives a message (i.e. emitted for ALL messages the current user can see)

     "message:direct": ({Message} message)

         When the currently logged in user recieves a direct message. The first parameter is
         the user that send the message. To get the author of the message, use `message.author` ({Person}).

     "message:mention": ({Room} room, {Message} message)

         When the currently logged in user is mentioned in a room. To get the author of the
         message, use `message.author` ({Person}).

     "room:new": ({Room} room)

         When a new room is added. Again does does NOT MEAN a new room was created on the
         server, only that it was loaded in memory. It can be assume however that after
         all rooms are loaded into memory and this event is fired, a new room has been
         created.

     "room:update": ({Room} room, {Object} changes)

         Emitted when a room is updated.

     "pong":

         Emitted when the client and server successfully completed the ping-pong frame
         exchange. Happens a lot, you probably won't need this frame ..unless ..maybe
         ..you like ping-pong.

     "error": ({Error} error)

         Emitted when an error occurs in the APIClient or processing an incoming frame.

     "disconnect":

         Emitted when the APIClient disconnects from the server. There is no need to
         attempt to reconnect or anything related to re-establishing the connection,
         the APIClient does that for you. This is just a notification to buffer messages
         to be sent until reconnection.

     "reconnect": ({Person[]} people, {Room[]} rooms, {Message[]} messages, {moment.duration} downtime)

         Emitted when the APIClient has disconnected and manages to reconnect to the API.
         The missed information between the disconnect and reconnect is passed as parameters.
         A fourth parameter called `downtime` also tells you how long you disconnected from the API.

#### rooms

The rooms store. We use an array instead of and object keyed with room IDs because
rooms are stored in an initialized (with ID) and uninitialized (without ID) states.
We therefore can't store them in an object by ID because we would have a bunch of
`undefined` keys.

#### monitor

Stats about this current session.

#### people

The people currently loaded in TeamworkChat.

Returns **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>** 

#### constructor

Create a new TeamworkChat instance.

**Parameters**

-   `api` **[APIClient](#apiclient)** An authorized APIClient instance.
-   `user` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User data to pass to Person#constructor.

Returns **[TeamworkChat](#teamworkchat)** 

#### onDisconnect

Event Handler: when the APIClient's socket `close`'s.

**Parameters**

-   `attempt`   (optional, default `r`)

#### onFrame

Event Handler: when the APIClient's socket recieves a `frame`. This is the handler that 
reads the incoming frame's `name` and handles it appropriately.

**Parameters**

-   `frame` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Parsed socket frame.

#### sendMessage

Override ability to send message to a Person object as this is an error,
the consumer would be attempting to send a message to themselves.

-   Throws **[Error](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error)** (Always)

#### sendMessageToPersonByHandle

Send a message to a person by their handle. See Person#sendMessage for more details.

**Parameters**

-   `handle` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The person's handle.
-   `message` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** See Person#sendMessage for details.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;Message>** See Person#sendMessage for returned details.

#### createRoomWithHandles

Create a room with the given handles. WARNING: This DOES NOT create the room
server side unless you provide `initialMessage`. The Chat API doesn't have an API
to create a room without the first message being sent. If you do not provide an
initialMessage, the room will be created in the first `sendMessage` request.

**Parameters**

-   `handles` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** The list of people's handles (without `@` symbol).
-   `initialMessage` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Optional initialMessage to initialize the room (i.e. server side).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Room](#room)>** The newly created room.

#### getRoomForHandles

Get a room containing (only) the people's handles. There's a couple of things to remember
when using this method:

1.  An existing room with the given handles will not be found unless it has been loaded in
    memory (e.g. via getAllRooms). The Chat API does not allow you to find room containing
    specific handles.
2.  If a room is not found with the given handles, an uninitialized room is created and the
    people are added. This room DOES NOT EXIST on the server until the first message is sent
    using `Room#sendMessage`.

Things to discuss: (TODO: discuss)

1.  Should we load all the rooms (if they're not already loaded), then attempt to find the room?
    This would be similiar to how `getPersonByHandle` works. It loads all people via `people.json` 
    and then selects the user via their handle. This isn't ideal but it's how the Chat GUI Client
    works. Should we use the same logic here?

**Parameters**

-   `handles` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** The list of people's handles (without `@` symbol).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Room](#room)>** The room.

#### getUnseenCount

Returned the unseen message counts in the form of:

 {
   important: { rooms {Number}, conversations {Number} },
   total: { rooms: {Number}, conversations: {Number} }
 }

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)>** Object containing message counts.

#### updateHandle

Update the currently logged in user's handle.

**Parameters**

-   `handle` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's handle (without the `@`).

Returns **[TeamworkChat](#teamworkchat)** The updated user.

#### updateStatus

Update the user's status.

**Parameters**

-   `status` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** See STATUS_TYPES exported from APIClient for available values.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves once frame is sent. There is no response from the server
                        for this so it's fire and forget.

#### findRoomForHandles

Find a room locally that includes the handles.

**Parameters**

-   `handles` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)>** The people's handles (without `@`).

Returns **[Room](#room)** The room, if any.

#### addRoom

Add a room to TeamworkChat and emit the appropriate events.

**Parameters**

-   `room` **[Room](#room)** The room object.

#### addRooms

Add multiple rooms.

**Parameters**

-   `rooms` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Room](#room)>** 

#### saveRoom

Save the room data from the API response to the appropriate room or create a new
room and add it if it does not exist.

**Parameters**

-   `rawRoom` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The room returned from the API.

Returns **[Room](#room)** The saved or created room.

#### findRoomById

Find a room by ID locally.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room's id.

Returns **[Room](#room)** 

#### findRoomByTitle

Find a room in memory by title.

**Parameters**

-   `title` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [RegExp](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp))** The exact title of the room or regex.

Returns **[Room](#room)** The room, if any.

#### getRoom

Get a room by ID. This attempts to find it in memory, if it does not exist,
it is loaded from the server and saved.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room ID.
-   `cached` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?= \` is** Optional, pick from the cache if room exists (default: true).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Room](#room)>** Resolves to the requested room.

#### getRoomByTitle

Get a room by it's title.

**Parameters**

-   `title` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [RegExp](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp))** The exact room title or a regex.

Returns **[Room](#room)** The room, if any.

#### getRooms

Get rooms from the server and save in memory.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The filter to pass to APIClient#getRooms.
-   `offset` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The cursor offset.
-   `limit` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The room count after the cursor.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Room](#room)>>** The list of rooms. The array also contains some extra properties:
                          offset, limit, total which are returned from the API.

#### getAllRooms

Get all the rooms from the API and save in memory. WARNING: This makes a lot of API 
calls if there is a lot of rooms so use sparingly. It is intentionally slow.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The filter to pass to APIClient#getRooms.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Room](#room)>>** The list of rooms.

#### findPersonById

Find a person in memory.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person's ID.

Returns **[Person](#person)** 

#### getPerson

Get a person by ID and save them.

**Parameters**

-   `id` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person's ID.
-   `cached` **[Boolean](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Boolean)?=  "me** Whether or not to search cache first.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Person](#person)>** 

#### getPersonBy

Find a person by a specific property. WARNING: If the person is not found in memory, 
`getAllPeople` is called and ALL PEOPLE are loaded from the API. The requested user is
then plucked from the returned values.

**Parameters**

-   `property` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The Person object's property to compare e.g. "id"
-   `value` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The value to compare Person[property]. If it matches, the person object is returned.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Person](#person)>** The found person object.

#### getPersonByHandle

Find or get a user by handle and save them.

**Parameters**

-   `handle` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's handle (without `@`)

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Person](#person)>** 

#### getPeople

Get list of people and save them.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Filter object passed to APIClient#getPeople.
-   `offset` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The cursor offset.
-   `limit` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The person count to return after the cursor.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>>** The returned people list.

#### getAllPeople

Get all available people and save them.

**Parameters**

-   `filter`  

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>>** 

#### savePerson

Save or create a person's data from the API.

**Parameters**

-   `rawPerson` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The person object from the API.

Returns **[Person](#person)** The updated person.

#### addPerson

Add a person to global room.

**Parameters**

-   `person` **[Person](#person)** 

#### addPeople

Add multiple person objects at once.

**Parameters**

-   `people` **[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;[Person](#person)>** 

#### getMessages

Get messages for user since now and `since`.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Object containing filters.
-   `page` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The message page (default: 1)
-   `pageSize` **[Number](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number)** The amount of messages to return (default: 50)

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Message>>** The retrieved messages.

#### getAllMessages

Get all messages for a user since a specific timestamp.

**Parameters**

-   `filter` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Object containing filters. See #getMessages.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[Array](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array)&lt;Message>>** The retrieved messages.

#### impersonate

Impersonate a person and return an authenticated TeamworkChat instance. This means you
are logged in as that person. For testing purposes only.

Remember: these are SEPERATE instances so they all managed rooms and rooms in
memory themselves and do not communicate with each other! This means different
TeamworkChat instances DO NOT INTEROPERATE.

Careful: Users may not be participating in the same rooms so they may not
be able to send messages to certain rooms! 404's will be returned.

**Parameters**

-   `person` **[Person](#person)** The person to impersonate.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** The impersonated person.

#### impersonateByHandle

Impersonate a person by their handle.

**Parameters**

-   `handle` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's handle.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** The impersonated person.

#### unimpersonate

Revert the impersonation.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves when impersonation revert request completes.

#### getUpdates

Get updates since a specific timestamp.

**Parameters**

-   `since` **moment** The moment timestamp to get updates since.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;\[]>** Resolves to an array of [people, rooms, messages].

#### update

Override parent method and remove `api` key from details. This can
happen if we happen to serialize this person (i.e. TeamworkChat) and
then attempt to `addPerson`, it would override our API instance.

**Parameters**

-   `details`  

#### logout

Logout the from the API and close the connection.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves once logged out.

#### close

Close the connection to Teamwork Chat servers and logout.

#### connect

Connect or reconnect a closed socket (i.e. after calling `.close`).

Returns **\[type]** [description]

#### emit

Override the default `emit` method to convert any `update` events to `user:update`
events. The `update` event happens in the parent Person class when the object is
update via the `update` method. Having an `update` event on this class doesn't make
sense so instead we convert updates to the currently logged in user as `user:update`.

**Parameters**

-   `eventName`  
-   `args` **...any** 

#### toJSON

Serialize the current user to JSON but include the API details. Don't forget, this is also
a Person object.

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** 

#### inspect

Convert the TeamworkChat to a useful debug string for `util.inspect`.

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** 

#### fromCredentials

Login to the Teamwork Chat API, open a socket to the chat-server and complete
the authentication flow. The API Client takes care of pings and disconnection
so all you need to worry about is closing the instance via `close` when you are
done. Otherwise, you can use `withCredentials` to automatically clean up and 
log the user out when complete (recommended). See TeamworkChat.withCredentials.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The installation URL.
-   `username` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The username used to login to Teamwork.
-   `password` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The password used to login to Teamwork (disposed after initial login request).

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** An authorized and fully connected TeamworkChat instance.

#### withCredentials

Use TeamworkChat with a promise "disposer" pattern. This is like `fromCredentials` except
you pass it a callback where you use the first parameter, `chat` (the initialized TeamworkChat)
instance and return any promise. When that returned promises finishes execution (regardless of
outcome -- rejection or resolving), the `disposer` function is called and the socket to Chat is
closed. This allows the process to exit appropriately and ensures any open sockets are closed.
This will also _log the user out_ when complete rendering the `tw-auth` token is useless.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The installation URL.
-   `username` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The username used to login to Teamwork.
-   `password` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The password used to login to Teamwork (disposed after initial login request).
-   `callback` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** The callback (!) that has param `chat` TeamworkChat instance. This returns
                                          a promise that when complete, closes the connection to Teamwork.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)** Resolves to nothing but ensures connection to Teamwork is closed fully.

#### fromAuth

Similar to `TeamworkChat.fromCredentials` except using a pre-existing auth key.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The installation URL.
-   `auth` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's auth key.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** An authorized and fully connected TeamworkChat instance.

#### withAuth

The very same functionality as `TeamworkChat.withCredentials` except using an auth key.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The installation URL.
-   `auth` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's auth key.
-   `callback` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** The callback (!) that has param `chat` TeamworkChat instance. This returns
                                          a promise that when complete, closes the connection to Teamwork.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** An authorized and fully connected TeamworkChat instance.

#### fromKey

Similar to `TeamworkChat.fromCredentials` except using a Projects API key.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The installation URL.
-   `key` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's Projects "API Key".

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** An authorized and fully connected TeamworkChat instance.

#### withKey

The very same functionality as `TeamworkChat.withCredentials` except using a Projects API key.

**Parameters**

-   `installation` **([String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String) \| [Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object))** The installation URL.
-   `key` **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** The user's Projects "API Key".
-   `callback` **[Function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function)** The callback (!) that has param `chat` TeamworkChat instance. This returns
                                          a promise that when complete, closes the connection to Teamwork.

Returns **[Promise](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise)&lt;[TeamworkChat](#teamworkchat)>** An authorized and fully connected TeamworkChat instance.
