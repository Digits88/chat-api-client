#!/usr/bin/env babel-node
import { inspect } from "util";
import program from "commander";
import TeamworkChat from "..";
import { INSTALLATION, USERNAME, PASSWORD } from "../test";

program
    .option("--json", "Output the events in JSON.")
    .parse(process.argv);

const dev = [INSTALLATION, USERNAME, PASSWORD];

TeamworkChat.fromCredentials(...dev).then(chat => {
    return [chat, chat.getRooms()];
}).spread(chat => {
    chat.on("*", (...details) => {
        if(program.json) {
            console.log(JSON.stringify({
                date: new Date(),
                event: details[0],
                data: details.slice(1) 
            }));
        } else {
            console.log(">>> " + details.map(detail => inspect(detail)).join("\t"));
        }
    });
}).catch(err => {
    console.error(err);
    process.exit(1);
});